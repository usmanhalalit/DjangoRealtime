{% load djangorealtime_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chatroom Dot Com - DjangoRealtime</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>

    {% djangorealtime_js %}

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Sans+MS&display=swap');

        body {
            font-family: 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
            /* Prevent iOS zoom on input focus */
            -webkit-text-size-adjust: 100%;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        .blink {
            animation: blink 1s linear infinite;
        }
    </style>
</head>
<body class="min-h-screen p-4 bg-gradient-to-br from-purple-400 via-pink-400 to-cyan-400">

<div class="max-w-4xl mx-auto">

    <header class="border-8 border-double border-gray-800 bg-gradient-to-r from-purple-500 to-pink-500 p-3 md:p-6 mb-4 shadow-2xl">
        <div class="flex items-center justify-between flex-wrap gap-2">
            <div class="flex items-center gap-2">
                <span class="text-3xl md:text-5xl">ğŸ’¬</span>
                <div>
                    <h1 class="text-xl md:text-4xl text-yellow-300 drop-shadow-lg">
                        <span class="blink">âœ¨</span> CHATROOM DOT COM <span class="blink">âœ¨</span>
                    </h1>
                    <p class="text-xs md:text-sm text-yellow-100 font-bold hidden md:block">
                        Welcome to the information superhighway!
                    </p>
                </div>
            </div>
            <div class="text-right bg-white/20 p-2 md:p-3 rounded-lg backdrop-blur-sm">
                <p class="text-white font-bold text-sm md:text-lg">ğŸ‘¤ {{ user.username }}</p>
                <button
                        hx-post="{% url 'chatroom:logout' %}"
                        hx-swap="none"
                        hx-on::after-request="window.location.href = '{% url 'chatroom:login' %}';"
                        class="text-xs md:text-sm text-yellow-200 hover:text-yellow-100 underline font-bold bg-transparent border-0 cursor-pointer"
                >
                    Log out
                </button>
            </div>
        </div>
    </header>

    <div class="border-8 border-double border-gray-800 bg-gray-100 p-2 md:p-6 shadow-2xl">

        <!-- Messages area -->
        <div
                id="messages-container"
                class="border-4 border-gray-600 bg-white p-2 md:p-4 h-[50vh] md:h-96 overflow-y-auto mb-4 shadow-inner flex flex-col-reverse"
                hx-get="{% url 'chatroom:get_messages' %}"
                hx-trigger="load, refreshMessages from:body"
                hx-swap="innerHTML"
        >
            {% include 'chatroom/partials/messages_list.html' %}
        </div>

        <form
                id="message-form"
                hx-post="{% url 'chatroom:send_message' %}"
                hx-swap="none"
                hx-on::after-request="this.reset(); htmx.trigger('#messages-container', 'refreshMessages'); document.querySelector('#message-input').focus();"
                class="flex gap-1 md:gap-2"
        >

            {% csrf_token %}
            <input
                    type="text"
                    id="message-input"
                    name="message"
                    placeholder="Type message... ğŸ“"
                    class="flex-1 p-2 md:p-4 border-4 border-gray-600 focus:outline-none focus:border-blue-500 text-base md:text-lg shadow-lg"
                    maxlength="160"
                    autocomplete="off"
                    required
            >

            <button
                    type="submit"
                    class="px-3 md:px-8 py-2 md:py-4 bg-gradient-to-b from-gray-100 to-gray-300 border-4 border-gray-600 text-sm md:text-lg hover:from-gray-200 hover:to-gray-400 active:from-gray-400 active:to-gray-500 shadow-lg whitespace-nowrap"
            >
                SEND! ğŸš€
            </button>
        </form>

        <div class="mt-2 md:mt-4 border-4 border-green-600 bg-gradient-to-r from-green-300 to-blue-300 p-2 md:p-3 shadow-lg">
            <div class="flex justify-around text-xs md:text-sm text-gray-900">
                <span class="text-sm md:text-base">âš¡ Status: <span class="text-green-700">CONNECTED</span></span>
                <span class="text-sm md:text-base" id="clock">ğŸ• <span></span></span>
            </div>
        </div>
    </div>

    <div class="border-8 border-double border-gray-800 bg-yellow-300 p-2 md:p-3 mt-4 shadow-2xl overflow-hidden">
        <marquee behavior="scroll" direction="left" class="text-xs md:text-lg text-red-600">
            ğŸ”¥ Welcome to the BEST chatroom on the web! ğŸ”¥
            Made with Django + HTMX ğŸ’»
            No Flash Player required! ğŸ˜
            Under construction since 1999 ğŸš§
            Visit our dotcom in GeoCities! ğŸŒŸ
        </marquee>
    </div>

    <footer class="text-center text-xs md:text-sm text-gray-800 mt-4 mb-8 bg-gray-200 p-2 md:p-3 border-t-4 border-gray-800 shadow-inner">
        <div class="mb-2 text-lg">
            Check source code on <strike>SourceForge</strike>
            <a href="https://github.com/usmanhalalit/DjangoRealtime/blob/main/examples/chatroom/templates/chatroom/chat.html" target="_blank" class="underline text-blue-600 hover:text-blue-800">
                GitHub</a>!
        </div>
        &copy; 1999 - Made with clichÃ©, heart-emoji, Django, HTMX and
        <a href="https://github.com/usmanhalalit/DjangoRealtime" target="_blank" class="underline text-blue-600 hover:text-blue-800">
            DjangoRealtime.
        </a>
    </footer>


    <div class="hidden sm:block fixed top-10 left-10 text-6xl animate-bounce">â­</div>
    <div class="hidden sm:block fixed top-20 right-20 text-5xl animate-pulse">âœ¨</div>
    <div class="hidden sm:block fixed bottom-20 left-20 text-6xl animate-spin" style="animation-duration: 3s;">ğŸŒŸ</div>
    <div class="hidden sm:block fixed bottom-32 right-16 text-4xl animate-bounce" style="animation-delay: 0.5s;">ğŸ’«</div>

</div>

<script>
    document.body.addEventListener('htmx:configRequest', (e) => {
        e.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    });

    // Listen for DjangoRealtime SSE messages and trigger htmx refresh
    window.addEventListener('djr:chat_message', () => {
        htmx.trigger('#messages-container', 'refreshMessages');
    });

    const clockSpan = document.querySelector('#clock span');
    setInterval(() => {
        if (!clockSpan) return;
        clockSpan.textContent = new Date().toLocaleTimeString();
    }, 1000);
</script>
</body>
</html>
